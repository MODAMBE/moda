<!DOCTYPE html>
<html lang="fr">
  <head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- PWA : iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />

    <!-- Manifest -->

    <link rel="manifest" href="{% static 'eglise/manifest/manifest.json' %}" />
    <meta name="theme-color" content="#0a0a0a" />

    <!-- IcÃ´nes PWA -->
    <link rel="icon" sizes="192x192" href="{% static 'eglise/manifest/modapp1.png' %}" />
    <link rel="apple-touch-icon" sizes="192x192" href="{% static 'eglise/manifest/modapp1.png' %}" />
    <link rel="icon" sizes="512x512" href="{% static 'eglise/manifest/modapp2.png' %}" />
    <link rel="apple-touch-icon" sizes="512x512" href="{% static 'eglise/manifest/modapp2.png' %}" />

    <link rel="manifest" href="{% static 'manifest/manifest.json' %}" />
    <meta name="theme-color" content="#0a0a0a" />

    <!-- IcÃ´nes PWA -->
    <link rel="icon" sizes="192x192" href="{% static 'manifest/modapp1.png' %}" />
    <link rel="apple-touch-icon" sizes="192x192" href="{% static 'manifest/modapp1.png' %}" />
    <link rel="icon" sizes="512x512" href="{% static 'manifest/modapp2.png' %}" />
    <link rel="apple-touch-icon" sizes="512x512" href="{% static 'manifest/modapp2.png' %}" />


    <title>
      {% block title %}
        AppMOEG
      {% endblock %}
    </title>

    <!-- CSS -->

    <link rel="stylesheet" href="{% static 'eglise/css/style.css' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />

    <!-- JS -->
    <script src="{% static 'eglise/js/script.js' %}" defer></script>

    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />

    <!-- JS -->
    <script src="{% static 'js/script.js' %}" defer></script>


    <style>
      .notif-btn {
        position: relative;
        display: inline-block;
      }
      .notif-btn .badge {
        position: absolute;
        top: -4px;
        right: -6px;
        background: red;
        color: white;
        font-size: 0.65rem;
        font-weight: bold;
        padding: 2px 5px;
        border-radius: 50%;
      }
      
      .top-bar {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding: 10px;
        gap: 15px;
        background: #f8f8f8;
        border-bottom: 1px solid #ddd;
      }
      
      .profile-section {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .profile-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
      }
      
      /* TOOLBAR BAS FIXE */
      .toolbar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 65px;
        background: white;
        display: flex;
        justify-content: space-around;
        align-items: center;
        border-top: 1px solid #ddd;
        z-index: 999;
      }
      
      .tool-btn {
        background: #007bff;
        color: white;
        padding: 10px 16px;
        border-radius: 12px;
        font-size: 14px;
        text-decoration: none;
      }
      
      .tool-btn.red {
        background: #ff4040;
      }
    </style>
  </head>

  <body>
    <!-- BARRE DU HAUT -->
    <div class="top-bar">
      {% if user.is_authenticated %}
        <a href="{% url 'eglise:notifications' %}" class="notif-btn">
          ðŸ””{% if non_lues and non_lues.count %}
            <span class="badge">{{ non_lues.count }}</span>
          {% endif %}
        </a>

        <div class="profile-section">
          <a href="{% url 'eglise:profil' user.username %}">
            {% if user.profile.image %}
              <img src="{{ user.profile.image.url }}" class="profile-img" alt="profile" />
            {% else %}

              <img src="{% static 'eglise/icons/default-profile.png' %}" class="profile-img" alt="profile" />

              <img src="{% static 'icons/default-profile.png' %}" class="profile-img" alt="profile" />

            {% endif %}
            <span>{{ user.username }}</span>
          </a>
        </div>
      {% endif %}
    </div>

    <!-- CONTENU -->
    <main style="padding-bottom: 80px;">
      {% block content %}

      {% endblock %}
    </main>

    <!-- TOOLBAR BAS -->
    {% if show_toolbar %}
      <div class="toolbar">
        <a class="tool-btn" href="{% url 'eglise:chaine_creer' %}">CrÃ©er</a>

        {% with mychaine=user.chaines.first %}
          {% if user.is_authenticated and mychaine %}
            <a class="tool-btn" href="{% url 'eglise:modifier_chaine' mychaine.username %}">Modifier</a>
            <a class="tool-btn red" href="{% url 'eglise:supprimer_chaine' mychaine.id %}">Supprimer</a>
          {% else %}
            <span class="tool-btn" style="background:#ccc;">Modifier</span>
            <span class="tool-btn red" style="background:#ccc;">Supprimer</span>
          {% endif %}
        {% endwith %}
      </div>
    {% endif %}
  </body>
</html>

<!-- SERVICE WORKER : version stable -->
<script>
  if ('serviceWorker' in navigator) {

    navigator.serviceWorker.register("{% static 'eglise/sw.js' %}")
  }
</script>

    navigator.serviceWorker.register("{% static 'sw.js' %}")
  }
</script>
<!-- AdSense -->
<script data-ad-client="{{ ADSENSE_CLIENT_ID }}" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- Meta Audience Network -->
<div class="ad-placement" data-placement-id="{{ META_AUDIENCE_PLACEMENT_ID }}"></div>

